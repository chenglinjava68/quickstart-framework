1、JVM 与 Linux 的内存关系详解.md    
2、JVM 和JMM的区别   

---------------------------------------------------------------------------------------------------------------------
1、JVM 与 Linux 的内存关系详解.md    

##一、Linux与进程内存模型

JVM以一个进程（Process）的身份运行在Linux系统上，了解Linux与进程的内存关系，是理解JVM与Linux内存的关系的基础。   

从硬件上看，Linux系统的内存空间由两个部分构成：物理内存和SWAP（位于磁盘）。  
物理内存是Linux活动时使用的主要内存区域； 
当物理内存不够使用时，Linux会把一部分暂时不用的内存数据放到磁盘上的SWAP中去，以便腾出更多的可用内存空间；   
而当需要使用位于SWAP的数据时，必须 先将其换回到内存中。  


从Linux系统上看，除了引导系统的BIN区，整个内存空间主要被分成两个部分：内核内存（Kernel space）、用户内存（User space）。 
内核内存是Linux自身使用的内存空间，主要提供给程序调度、内存分配、连接硬件资源等程序逻辑使用。   
用户内存是提供给各个进程主要空间，Linux给各个进程提供相同的虚拟内存空间；这使得进程之间相互独立，互不干扰。    
实现的方法是采用虚拟内存技术：给每一个进程一定虚拟内存空间，而只有当虚拟内存实 际被使用时，才分配物理内存。  

从进程的角度来看，进程能直接访问的用户内存（虚拟内存空间）被划分为5个部分：代码区、数据区、堆区、栈区、未使用区。   

代码区中存放应用程序的机器代码，运行过程中代码不能被修改，具有只读和固定大小的特点。      
数据区中存放了应用程序中的全局数据，静态数据和一些常量字符串等，其大小也是固定的。       
堆是运行时程序动态申请的空间，属于程序运行时直接申请、释放的内存资源。     
栈区用来存放函数的传入参数、临时变量，以及返回地址等数据。       
未使用区是分配新内 存空间的预备区域。     


##二、进程与JVM内存空间
JVM本质就是一个进程，因此其内存空间（也称之为运行时数据区，注意与JMM的区别）也有进程的一般特点。深入浅出 Java 中 JVM 内存管理，这篇参考下。
但是，JVM又不是一个普通的进程，其在内存空间上有许多崭新的特点，主要原因有两 个：

- JVM将许多本来属于操作系统管理范畴的东西，移植到了JVM内部，目的在于减少系统调用的次数；
- Java NIO，目的在于减少用于读写IO的系统调用的开销。JVM进程与普通进程内存模型比较如下图:


1.用户内存  

2.内核内存
应用程序通常不直接和内核内存打交道，内核内存由操作系统进行管理和使用；  
不过随着Linux对性能的关注及改进，一些新的特性使得应用程序可以使 用内核内存，或者是映射到内核空间。    
Java NIO正是在这种背景下诞生的，其充分利用了Linux系统的新特性，提升了Java程序的IO性能。



参考      
https://juejin.im/post/5cceea7c6fb9a0322279307b     
https://blog.csdn.net/hxcaifly/article/details/82563269     
---------------------------------------------------------------------------------------------------------------------

2、JVM 和JMM的区别  

首先从定义上看
- JVM (Java Virtual Machine)Java虚拟机模型 主要描述的是Java虚拟机内部的结构以及各个结构之间的关系。
- JMM(Java Memory Model) Java内存模型 主要规定了一些内存和线程之间的关系


其次从内存结构上看
- JVM内存结构：PC程序计数器，虚拟机栈，方法栈，堆，方法区
- 主内存、工作内存（线程本地内存）


Java内存模型(Java Memory Model，JMM)JMM主要是为了规定了线程和内存之间的一些关系。     
根据JMM的设计，系统存在一个主内存(Main Memory)，Java中所有变量都储存在主存中，对于所有线程都是共享的。   
每条线程都有自己的工作内存(Working Memory)，工作内存中保存的是主存中某些变量的拷贝，线程对所有变量的操作都是在工作内存中进行，线程之间无法相互直接访问，变量传递均需要通过主存完成。



总结：     
jmm中的主内存、工作内存与jvm中的Java堆、栈、方法区等并不是同一个层次的内存划分，这两者基本上是没有关系的，
如果两者一定要勉强对应起来，那从变量、主内存、工作内存的定义来看，主内存主要对应于Java堆中的对象实例数据部分，而工作内存则对应于虚拟机栈中的部分区域。   
从更低层次上说，主内存就直接对应于物理硬件的内存，而为了获取更好的运行速度，虚拟机（甚至是硬件系统本身的优化措施）可能会让工作内存优先存储于寄存器和高速缓存中，因为程序运行时主要访问读写的是工作内存。




参考  
https://www.cnblogs.com/huxuer/p/9066269.html   
https://blog.csdn.net/zhaomengszu/article/details/80270696



